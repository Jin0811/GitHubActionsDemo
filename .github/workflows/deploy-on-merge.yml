name: Build and Archive

on:
  push:
    branches: [ test ]  # ç›‘å¬teståˆ†æ”¯çš„push

jobs:
  build-and-archive:
    runs-on: ubuntu-latest
    steps:
    # æ‹‰å–æœ€æ–°ä»£ç 
    - name: Checkout code
      uses: actions/checkout@v4

    # è®¾ç½®nodeç‰ˆæœ¬
    - name: Setup Node
      uses: actions/setup-node@v3
      with:
        node-version: '22.12.0'
        cache: 'yarn'

    # ç¼“å­˜ä¾èµ–
    - name: Cache Yarn dependencies
      uses: actions/cache@v3
      with:
        path: |
          node_modules
          ~/.cache/yarn
        key: ${{ runner.os }}-yarn-${{ hashFiles('yarn.lock') }}
        restore-keys: |
          ${{ runner.os }}-yarn-

     # å®‰è£…ä¾èµ–
    - name: Install dependencies
      run: yarn install --frozen-lockfile

    # æ„å»ºé¡¹ç›®
    - name: Build project
      run: yarn build  

    # å­˜æ¡£äº§ç‰©
    - name: Archive production build
      uses: actions/upload-artifact@v4
      with:
        name: vue-dist # å­˜æ¡£åç§°
        path: dist/ # å­˜æ¡£distç›®å½•
        retention-days: 7 # å­˜æ¡£ä¿ç•™å¤©æ•°ï¼ˆé»˜è®¤90å¤©ï¼‰

    # å‘é€é‚®ä»¶
    - name: Send mail
      uses: dawidd6/action-send-mail@v3  # è¿™é‡Œä»¥v3ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå»ºè®®æŸ¥çœ‹å…¶ä»“åº“ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
      with:
        server_address: smtp.163.com
        server_port: 465  # æˆ– 994, å»ºè®®ä½¿ç”¨SSLç«¯å£:cite[5]
        username: ${{ secrets.MAIL_USERNAME }}  # ä½ åœ¨Secretsä¸­è®¾ç½®çš„é‚®ç®±åœ°å€å˜é‡
        password: ${{ secrets.MAIL_PASSWORD }}  # ä½ åœ¨Secretsä¸­è®¾ç½®çš„æˆæƒç å˜é‡
        subject: æ‚¨çš„é¡¹ç›®æ„å»ºæˆåŠŸï¼ğŸ‰  # é‚®ä»¶ä¸»é¢˜
        body: |
          <h2>æ„å»ºæˆåŠŸï¼</h2>
          <p>é¡¹ç›® ${{ github.repository }} çš„åˆ†æ”¯ ${{ github.ref }} å·²äº ${{ utcnow() }} æ„å»ºæˆåŠŸã€‚</p>
          <p>è¯¦æƒ…è¯·æŸ¥çœ‹ï¼š<a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}">GitHub Actionsè¿è¡Œè®°å½•</a></p>
        to: 15797954826@163.com  # æ¥æ”¶é‚®ä»¶çš„åœ°å€
        from: GitHub Actions Bot  # å‘ä»¶äººåç§°
        content_type: text/html  # é‚®ä»¶å†…å®¹ç±»å‹ï¼Œæ­¤å¤„ä½¿ç”¨HTML